<!DOCTYPE html>
<html lang="en">
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-24HL4B73C3"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','G-24HL4B73C3');</script>
<meta charset="UTF-8">
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<meta name="theme-color" content="#00d4ff">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Discovery Flow - NEXUS</title>
<link rel="stylesheet" href="/css/nexus-base.css">
<style>
body { padding-top: 60px; }
.discovery-container { max-width: 800px; margin: 0 auto; padding: var(--spacing-xl) var(--spacing-md); min-height: calc(100vh - 60px); transition: padding-right 0.3s ease; }
.discovery-container.sidebar-open { padding-right: 300px; }
.progress-bar { height: 4px; background: rgba(0, 212, 255, 0.2); border-radius: var(--radius-full); margin-bottom: var(--spacing-xl); overflow: hidden; }
.progress-fill { height: 100%; background: linear-gradient(90deg, var(--accent-color), var(--deep-purple)); transition: width 0.3s ease; box-shadow: var(--glow-aqua); }
.step { display: none; animation: fadeIn 0.5s ease-out; }
.step.active { display: block; }
.question { font-size: 1.5rem; color: var(--accent-color); margin-bottom: var(--spacing-lg); text-align: center; }
.nav-buttons { display: flex; gap: var(--spacing-md); margin-top: var(--spacing-xl); justify-content: space-between; }
.tag-sidebar { position: fixed; right: 0; top: 60px; width: 280px; max-height: calc(100vh - 80px); background: rgba(26, 29, 36, 0.95); border-left: 2px solid rgba(0, 212, 255, 0.3); padding: var(--spacing-md); overflow-y: auto; z-index: 100; transition: transform 0.3s ease; backdrop-filter: blur(10px); }
.tag-sidebar.collapsed { transform: translateX(240px); }
.tag-sidebar.collapsed .sidebar-content { opacity: 0; pointer-events: none; }
.sidebar-toggle { position: absolute; left: -40px; top: 50%; transform: translateY(-50%); width: 40px; height: 80px; background: rgba(0, 212, 255, 0.2); border: 1px solid rgba(0, 212, 255, 0.4); border-right: none; border-radius: var(--radius-md) 0 0 var(--radius-md); color: var(--accent-color); cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 0.8rem; }
.sidebar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-md); padding-bottom: var(--spacing-sm); border-bottom: 1px solid rgba(0, 212, 255, 0.2); }
.sidebar-header h3 { color: var(--accent-color); font-size: 0.9rem; margin: 0; text-transform: uppercase; letter-spacing: 0.05em; }
.sidebar-tags { display: flex; flex-wrap: wrap; gap: var(--spacing-xs); margin-bottom: var(--spacing-md); }
.sidebar-tag { display: inline-flex; align-items: center; gap: 4px; font-size: 0.75rem; padding: 4px 8px; background: rgba(0, 212, 255, 0.15); border: 1px solid rgba(0, 212, 255, 0.3); border-radius: 12px; color: var(--text-primary); cursor: pointer; }
.sidebar-tag:hover { background: rgba(255, 100, 100, 0.2); border-color: rgba(255, 100, 100, 0.5); }
.sidebar-tag .x { margin-left: 4px; opacity: 0.6; }
.sidebar-tag:hover .x { opacity: 1; color: #ff6464; }
.sidebar-empty { text-align: center; padding: var(--spacing-lg); opacity: 0.6; font-size: 0.85rem; }
.sidebar-add-btn { width: 100%; padding: var(--spacing-sm); background: transparent; border: 1px dashed rgba(0, 212, 255, 0.4); border-radius: 12px; color: var(--accent-color); cursor: pointer; font-size: 0.85rem; }
.sidebar-add-btn:hover { background: rgba(0, 212, 255, 0.1); border-style: solid; }
.modal { position: fixed; z-index: 10000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0, 0, 0, 0.7); display: flex; align-items: center; justify-content: center; }
.modal-content { margin: auto; animation: fadeIn 0.3s ease-out; }

/* === STRUCTURED DISCOVERY PILLS === */
.step-header { text-align: center; margin-bottom: var(--spacing-xl); }
.step-badge { display: inline-block; padding: 6px 16px; background: rgba(0, 212, 255, 0.15); border: 1px solid rgba(0, 212, 255, 0.3); border-radius: 20px; color: var(--accent-color); font-size: 0.85rem; font-weight: 500; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: var(--spacing-md); }
.picks-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: var(--spacing-md); margin-bottom: var(--spacing-xl); }
.pick-pill { display: block; padding: var(--spacing-md); background: rgba(42, 45, 52, 0.6); border: 2px solid rgba(0, 212, 255, 0.25); border-radius: 16px; cursor: pointer; transition: all 0.2s ease; text-align: center; }
.pick-pill:hover { border-color: var(--accent-color); background: rgba(0, 212, 255, 0.08); transform: translateY(-2px); }
.pick-pill.selected { border-color: var(--highlight-color); background: rgba(212, 175, 55, 0.15); box-shadow: 0 0 15px rgba(212, 175, 55, 0.3); }
.pick-pill input[type="checkbox"] { display: none; }
.pill-content { display: flex; flex-direction: column; gap: 4px; }
.pill-label { font-size: 1rem; font-weight: 600; color: var(--text-primary); }
.pill-desc { font-size: 0.8rem; opacity: 0.7; }
.browse-link { display: block; width: 100%; padding: var(--spacing-sm); background: transparent; border: 1px dashed rgba(0, 212, 255, 0.4); border-radius: 12px; color: var(--accent-color); cursor: pointer; font-size: 0.9rem; margin-bottom: var(--spacing-xl); }
.browse-link:hover { background: rgba(0, 212, 255, 0.08); border-style: solid; }
.btn-pill { border-radius: 25px !important; padding: 12px 28px !important; }
.preview-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-lg); padding-bottom: var(--spacing-md); border-bottom: 1px solid rgba(0, 212, 255, 0.2); }
.preview-header h3 { color: var(--accent-color); margin: 0; }
.tag-count { background: rgba(0, 212, 255, 0.2); padding: 4px 12px; border-radius: 12px; font-size: 0.85rem; }
.preview-category { margin-bottom: var(--spacing-lg); }
.preview-category h4 { color: var(--accent-color); font-size: 0.9rem; margin-bottom: var(--spacing-sm); text-transform: uppercase; letter-spacing: 0.05em; }
.preview-tags { display: flex; flex-wrap: wrap; gap: var(--spacing-xs); }
.preview-tag { display: inline-block; padding: 6px 14px; background: rgba(0, 212, 255, 0.15); border: 1px solid rgba(0, 212, 255, 0.3); border-radius: 20px; font-size: 0.9rem; }
.empty-msg { text-align: center; opacity: 0.7; padding: var(--spacing-xl); }
.completion-panel { max-width: 700px; margin: 0 auto; text-align: center; padding: var(--spacing-xl); }
.completion-tags { text-align: left; margin: var(--spacing-xl) 0; padding: var(--spacing-lg); background: rgba(0, 212, 255, 0.05); border-radius: var(--radius-md); }
.completion-category { margin-bottom: var(--spacing-md); }
.completion-category h4 { color: var(--accent-color); font-size: 0.85rem; margin-bottom: var(--spacing-xs); }
.tag-row { display: flex; flex-wrap: wrap; gap: var(--spacing-xs); }
.completion-actions { display: flex; gap: var(--spacing-md); justify-content: center; flex-wrap: wrap; }
.modal-category { margin-bottom: var(--spacing-lg); }
.modal-category h4 { color: var(--accent-color); font-size: 0.9rem; margin-bottom: var(--spacing-sm); padding-bottom: var(--spacing-xs); border-bottom: 1px solid rgba(0, 212, 255, 0.2); }
.modal-tags { display: flex; flex-wrap: wrap; gap: var(--spacing-sm); }
.modal-tag { padding: 8px 16px; background: rgba(42, 45, 52, 0.6); border: 1px solid rgba(0, 212, 255, 0.3); border-radius: 20px; cursor: pointer; transition: all 0.2s ease; font-size: 0.9rem; }
.modal-tag:hover { border-color: var(--accent-color); background: rgba(0, 212, 255, 0.1); }
.modal-tag.selected { background: rgba(212, 175, 55, 0.2); border-color: var(--highlight-color); }
.profile-preview { background: var(--primary-bg); border: 1px solid rgba(0, 212, 255, 0.3); border-radius: var(--radius-md); padding: var(--spacing-lg); margin-top: var(--spacing-lg); }
@media (max-width: 900px) { .tag-sidebar { width: 100%; max-width: 300px; } .discovery-container.sidebar-open { padding-right: var(--spacing-md); } }
@media (max-width: 600px) { .tag-sidebar { max-width: none; width: 85%; } .tag-sidebar.collapsed { transform: translateX(calc(100% - 40px)); } }
</style>
</head>
<body>
<div id="tagSidebar" class="tag-sidebar collapsed">
  <button class="sidebar-toggle" onclick="toggleTagSidebar()"><span class="tag-count" id="sidebarTagCount">0</span><span>tags</span></button>
  <div class="sidebar-content">
    <div class="sidebar-header"><h3>Your Tags</h3></div>
    <div id="sidebarTags" class="sidebar-tags"></div>
    <div id="sidebarEmpty" class="sidebar-empty">Click tags to add them</div>
    <button class="sidebar-add-btn" onclick="openTagBrowser()">+ Browse All Tags</button>
  </div>
</div>

<div class="discovery-container" style="margin-top: 60px;">
  <div class="progress-bar"><div class="progress-fill" id="progressFill" style="width: 0%"></div></div>

  <!-- Step 0: Welcome -->
  <div class="step active" id="step0">
    <div class="panel text-center">
      <h1 class="text-gradient">Welcome to NEXUS Discovery</h1>
      <p style="font-size: 1.2rem; margin: var(--spacing-lg) 0;">Let's understand what connection means to you.</p>
      <p style="opacity: 0.8; margin-bottom: var(--spacing-xl);">Pick the options that resonate with you. No wrong answers.</p>
      <div style="display: flex; gap: var(--spacing-md); justify-content: center;">
        <a href="/" class="btn btn-outline btn-large btn-pill">Cancel</a>
        <button class="btn btn-primary btn-large btn-pill" onclick="startDiscovery()">Begin Discovery</button>
      </div>
    </div>
  </div>

  <!-- Question steps 1-6 are dynamically generated by discovery.js -->

  <!-- Review Step -->
  <div class="step" id="stepReview">
    <div class="panel">
      <h2 class="text-gradient">Your Profile Preview</h2>
      <p style="margin-bottom: var(--spacing-lg);">Here's what you've selected:</p>
      <div class="profile-preview" id="profilePreview"></div>
      <div class="nav-buttons">
        <button class="btn btn-outline btn-pill" onclick="previousStep()">Back</button>
        <button class="btn btn-primary btn-large btn-pill" onclick="saveProfile()">Save & Enter NEXUS</button>
      </div>
    </div>
  </div>
</div>

<!-- Tag Browser Modal -->
<div id="tagBrowserModal" class="modal" style="display: none;">
  <div class="modal-content panel" style="max-width: 900px; max-height: 80vh; overflow-y: auto;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-lg); padding-bottom: var(--spacing-md); border-bottom: 1px solid rgba(0, 212, 255, 0.2);">
      <h2 class="text-gradient" style="margin: 0;">Browse Tags</h2>
      <button onclick="closeTagBrowser()" style="background: none; border: none; color: var(--accent-color); font-size: 2rem; cursor: pointer;">&times;</button>
    </div>
    <div style="margin-bottom: var(--spacing-md);"><input type="text" id="tagSearch" placeholder="Search tags..." oninput="filterModalTags()" class="form-input" style="width: 100%;"/></div>
    <div style="margin-bottom: var(--spacing-md);"><select id="categoryFilter" onchange="filterModalTags()" class="form-select" style="width: 100%;"><option value="">All Categories</option></select></div>
    <div id="modalTagsContainer"></div>
    <div style="display: flex; gap: var(--spacing-md); justify-content: flex-end; padding-top: var(--spacing-md); border-top: 1px solid rgba(0, 212, 255, 0.2);">
      <button onclick="closeTagBrowser()" class="btn btn-outline btn-pill">Cancel</button>
      <button onclick="addSelectedTagsFromModal()" class="btn btn-primary btn-pill">Add Selected</button>
    </div>
  </div>
</div>

<script src="/auth.js"></script>
<script src="/js/passport.js"></script>
<script src="/js/navbar.js"></script>
<script src="/js/nexus-core.js"></script>
<script src="/js/discovery.js"></script>
<script>
  // PASSPORT age gate check (21+ site)
  document.addEventListener('DOMContentLoaded', async () => {
    await window.passport.init();
    window.passport.requireAge(21, 'DiscoverNexus requires you to be 21 or older.');
  });
</script>
<script src="/js/cookie-consent.js"></script>
</body>
</html>